<!DOCTYPE html>
<html>
  <head>
    <title>ng-spa - level 4</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0-beta.6/angular.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <style>
      section {
        margin: 0 auto;
        width: 77.77%;
      }
      footer>em{
        display: block;
        font-size: 0.8em;
      }
    </style>
    <script>
      angular.module('myApp', []).controller('myController', myController);
      function myController($scope){
        $scope.articles = [];
        $scope.post = {};
        $scope.addPost = function(post){
          post.createdAt = new Date().getTime();
          post.titleLength = $scope.numberOfCar(post.title);
          post.contentLength = $scope.numberOfCar(post.content);
          $scope.articles.push(angular.copy(post));
          $scope.post = {};
          $scope.form.$setPristine();
          $scope.form.$setUntouched();
        }
        $scope.numberOfCar = function(text){
            return text ? (text + '').length : 0;
        }
      }
    </script>
  </head>
  <body ng-app="myApp" ng-controller="myController">
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">ng-spa - level 4</a>
        </div>
        <div class="collapse navbar-collapse">
          <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Rechercher" ng-model="search">
            </div>
          </form>
        </div>
      </div>
    </nav>
    <section>
      <article class="well" ng-repeat="item in articles | filter:{$:search}">
        <header>
          <h2 ng-click="item.editTitle = true" ng-show="!item.editTitle">{{item.title}}</h2>
          <div class="form-group" ng-show="item.editTitle">
            <label for="title">Titre de l'article</label>
            <input type="text" class="form-control" ng-model="item.title" ng-blur="item.editTitle = false">
          </div>
        </header>
        <p ng-click="item.editContent = true" ng-show="!item.editContent">{{item.content}}</p>
        <div class="form-group" ng-show="item.editContent">
          <label for="content">Contenu de l'article</label>
          <textarea name="content" class="form-control" ng-model="item.content" ng-blur="item.editContent = false"></textarea>
        </div>
      <footer>
        <em>{{item.createdAt | date:'medium'}}</em>
        <em>
          <ng-pluralize count="item.titleLength"
                 when="{'0': 'Le titre n\'a aucun caractère.',
                     'one': 'Le titre a {} caractère.',
                     'other': 'Le titre a {} caractères.'}">
          </ng-pluralize>
        </em>
        <em>
          <ng-pluralize count="item.contentLength"
                 when="{'0': 'Le billet n\'a aucun caractère.',
                     'one': 'Le billet a {} caractère.',
                     'other': 'Le billet a {} caractères.'}">
          </ng-pluralize>
        </em>
      </footer>
    </article>
    <hr>
    <form name="form" ng-submit="addPost(post)" novalidate>
      <div class="form-group"
        ng-class="{'has-error': (form.$submitted || form.title.$touched) && form.title.$error.required}">
        <label for="title" class="control-label">
          Titre de l'article
          <span ng-show="(form.$submitted || form.title.$touched) && form.title.$error.required">
            <small>(le titre est obligatoire pour créer un article)</small>
          </span>
        </label>
        <input type="text" name="title" class="form-control" autocomplete="off" ng-model="post.title" required />
        <small>
          <ng-pluralize count="numberOfCar(post.title)"
                 when="{'0': 'Aucun caractère.',
                     'one': 'Un seule caractère.',
                     'other': '{} caractères.'}">
          </ng-pluralize>
        </small>
      </div>
      <div class="form-group"
        ng-class="{'has-error': (form.$submitted || form.content.$touched) && form.content.$error.required}">
        <label for="content" class="control-label">
          Contenu de l'article
          <span ng-show="(form.$submitted || form.content.$touched) && form.content.$error.required">
          <small>(le contenu est obligatoire pour créer un article)</small></span>
        </label>
        <textarea name="content" class="form-control" ng-model="post.content" required ></textarea>
        <small>
          <ng-pluralize count="numberOfCar(post.content)"
                 when="{'0': 'Aucun caractère.',
                     'one': 'Un seule caractère.',
                     'other': '{} caractères.'}">
          </ng-pluralize>
        </small>
      </div>
      <button type="submit" class="btn btn-default" ng-disabled="form.$invalid">Ajouter un article</button>
    </form>
  </section>
  <section ng-show="post.title || post.content">
    <hr>
    <header>
      <h3>Aperçu</h3>
    </header>
    <article class="well">
      <header>
        <h2>{{post.title}}</h2>
      </header>
      <p>{{post.content}}</p>
    </article>
  </section>
</body>
</html>